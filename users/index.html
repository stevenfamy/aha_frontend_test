<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@2.4.0/build/global/luxon.min.js"></script>
    <script src="/js/cookies.js"></script>
    <script src="/js/check_sessions.js"></script>
    <script src="/js/logout.js"></script>
    <title>Users Management</title>
    <style>
      table {
        font-family: Arial, Helvetica, sans-serif;
        border-collapse: collapse;
        width: 100%;
      }

      table td,
      table thead {
        border: 1px solid #ddd;
        padding: 8px;
      }

      table tr:nth-child(even) {
        background-color: #f2f2f2;
      }

      table thead {
        padding-top: 12px;
        padding-bottom: 12px;
        text-align: left;
        background-color: #0446aa;
        color: white;
      }
    </style>
  </head>
  <body onload="start()">
    <h2>Users Management</h2>
    <a href="/dashboard/">Home</a> | <a href="/profiles/">My Profile</a> |
    <a href="/users/">Users Management</a> |
    <a href="#" onclick="doLogout()">Logout</a>
    <hr />
    <table>
      <thead>
        <tr>
          <td>Full Name</td>
          <td>Email Address</td>
          <td>Signed up on</td>
          <td>Total Login</td>
          <td>Last Login on</td>
        </tr>
      </thead>
      <tbody id="userListBody"></tbody>
    </table>
    <script>
      var DateTime = luxon.DateTime;

      function start() {
        checkSessions();

        const cookieSessions = getCookie("authToken");
        const headers = {
          "Content-Type": "application/json",
          authToken: cookieSessions,
        };
        const url = `http://localhost:5000/user/`;

        axios
          .get(url, { headers: headers })
          .then((res) => {
            if (res.status === 200) {
              let content = "";
              res.data.userList.forEach((user) => {
                content += `<tr>
                  <td>${user.users_profile.first_name} ${
                  user.users_profile.last_name
                }</td>
                  <td>${user.email}</td>
                  <td>${DateTime.fromISO(user.created_on).toLocaleString(
                    DateTime.DATETIME_FULL
                  )}</td>
                  <td>${user.total_login}</td>
                  <td>${DateTime.fromISO(user.last_login).toLocaleString(
                    DateTime.DATETIME_FULL
                  )}</td>
                  </tr>`;
              });
              document.getElementById("userListBody").innerHTML = content;
              console.log(res);
            }
          })
          .catch((err) => {
            if (err.response.status === 404) {
              document.getElementById("userListBody").innerHTML =
                "<tr><td colspan='5'>No Data</td></tr>";
            }
          });
      }
    </script>
  </body>
</html>
