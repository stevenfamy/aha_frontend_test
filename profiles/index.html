<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="/js/cookies.js"></script>
    <script src="/js/check_sessions.js"></script>
    <script src="/js/logout.js"></script>
    <title>My Profile</title>
  </head>
  <body onload="start()">
    <h2>My Profile</h2>
    <a href="/dashboard/">Home</a> | <a href="/profiles/">My Profile</a> |
    <a href="/users/">User Management</a> |
    <a href="#" onclick="doLogout()">Logout</a>

    <hr />
    <h3 id="profileMessage" style="padding: 5px"></h3>
    <table>
      <tbody>
        <tr>
          <td style="padding: 5px">First Name</td>
          <td style="padding: 5px">
            <input
              type="text"
              name="firstName"
              id="firstName"
              placeholder="First Name"
            />
          </td>
        </tr>
        <tr>
          <td style="padding: 5px">Last Name</td>
          <td style="padding: 5px">
            <input
              type="text"
              name="lastName"
              id="lastName"
              placeholder="Last Name"
            />
          </td>
        </tr>
        <tr>
          <td colspan="2" style="padding: 5px">
            <input
              type="button"
              value="Update"
              id="doUpdate"
              name="doUpdate"
              onclick="doUpdate()"
              style="width: 100%"
            />
          </td>
        </tr>
      </tbody>
    </table>

    <script>
      function start() {
        checkSessions();

        const cookieSessions = getCookie("authToken");
        const headers = {
          "Content-Type": "application/json",
          authToken: cookieSessions,
        };
        const url = `http://localhost:5000/user/profile`;

        axios
          .get(url, { headers: headers })
          .then((res) => {
            if (res.status === 200) {
              document.getElementById("firstName").value =
                res.data.userProfile.firstName;
              document.getElementById("lastName").value =
                res.data.userProfile.lastName;
            }
          })
          .catch((err) => {
            document.getElementById("profileMessage").innerHTML =
              err.response.data.error;
          });
      }

      function doUpdate() {
        const cookieSessions = getCookie("authToken");
        const firstName = document.getElementById("firstName").value;
        const lastName = document.getElementById("lastName").value;
        const url = "http://localhost:5000/user/profile";

        const headers = {
          "Content-Type": "application/json",
          authToken: cookieSessions,
        };
        const params = {
          firstName,
          lastName,
        };

        axios
          .put(url, params, { headers: headers })
          .then((res) => {
            document.getElementById("profileMessage").innerHTML =
              "Successfully save your profile";
          })
          .catch((err) => {
            document.getElementById("profileMessage").innerHTML =
              err.response.data.error;
          });
      }
    </script>
  </body>
</html>
